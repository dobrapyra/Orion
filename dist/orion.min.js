/*!
 * Orion
 * version: 2018.05.14
 * author: dobrapyra
 * url: https://github.com/dobrapyra/Orion
 */
/*! Polyfills - https://github.com/dobrapyra/EasyPure */
Object.keys||(Object.keys=function(t){if(t!==Object(t))throw new TypeError("Object.keys called on a non-object");var e,i=[];for(e in t)t.hasOwnProperty(e)&&i.push(e);return i}),Object.assign||(Object.assign=function(t){if(t!==Object(t))throw new TypeError("Object.assign called on a non-object");var e,i,s,r,n,a,o,h;for(e=Object(t),n=arguments.length,r=1;r<n;r++)if(i=arguments[r])for(o=(s=Object.keys(i)).length,a=0;a<o;a++)e[h=s[a]]=i[h];return e});
/*! GameLoop - https://github.com/dobrapyra/GameLoop */
var Loop=function(t){this.init(t)};Object.assign(Loop.prototype,{init:function(t){var e=function(){};this.onUpdate=t.handleUpdate||e,this.onRender=t.handleRender||e,this.onPanic=t.handlePanic||e,this.onRawFrame=t.handleRawFrame||null,this.timestep=t.timestep||1e3/60,this.minFrameTime=1e3/(t.fpsLimit||66),this.fpsMeter=t.fpsMeter||!0,this.started=!1,this.running=!1,this.rafId=null,this.lastFrameTime=0,this.lastFpsUpdate=0,this.framesThisSecond=0,this.delta=0,this.fps=this.fpsMeter?0:null,this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.initLoop=this.initLoop.bind(this),this.loop=this.loop.bind(this)},update:function(t){this.onUpdate(t)},render:function(t){this.onRender(t,this.fps)},start:function(){this.started||(this.started=!0,this.rafId=requestAnimationFrame(this.initLoop))},stop:function(){this.running=!1,this.started=!1,cancelAnimationFrame(this.rafId)},initLoop:function(t){this.render(1),this.running=!0,this.lastFrameTime=t,this.lastFpsUpdate=t,this.framesThisSecond=0,this.rafId=requestAnimationFrame(this.loop)},loop:function(t){if(null!==this.onRawFrame)return this.onRawFrame(t),void(this.rafId=requestAnimationFrame(this.loop));if(t<this.lastFrameTime+this.minFrameTime)this.rafId=requestAnimationFrame(this.loop);else{this.delta+=t-this.lastFrameTime,this.lastFrameTime=t,this.fpsMeter&&(t>this.lastFpsUpdate+1e3&&(this.fps=this.framesThisSecond,this.lastFpsUpdate=t,this.framesThisSecond=0),this.framesThisSecond++);for(var e=0;this.delta>=this.timestep;)if(this.update(this.timestep),this.delta-=this.timestep,240<=++e){this.panic();break}this.render(this.delta/this.timestep),this.rafId=requestAnimationFrame(this.loop)}},panic:function(){this.delta=0,this.onPanic()}});
/*! Orion - constellation */
var OrionConstellation=function(t){this.init(t)};Object.assign(OrionConstellation.prototype,{init:function(t){var e=t.points||{},i=t.force||{},s=t.amplitude||{},r=t.speed||{},n=t.opacity||{};this.onlyInside=t.onlyInside||!1,this.borderVertices=Object.assign([],e.border),this.prepareVertices(this.borderVertices,{force:i.border||60},{static:!0,border:!0}),this.insideVertices=Object.assign([],e.inside),this.prepareVertices(this.insideVertices,{ampMin:s.min,ampMax:s.max,speedMin:r.min,speedMax:r.max,force:i.border||40}),this.cursorPoint={curr:{x:0,y:0},hidden:!!this.onlyInside,force:i.cursor||120},this.vertices=[].concat(this.borderVertices,this.insideVertices),this.vertices.push(this.cursorPoint),this.createEdges(),this.cursorPoint.static=!0,this.borderStrokeStyle="rgba(255,255,255,"+(void 0!==n.border?n.border:.5)+")"},prepareVertices:function(t,e,i){for(var s=!(!i||!i.static),r=void 0!==e.ampMin?e.ampMin:10,n=e.ampMax?e.ampMax-r:0,a=e.speedMin||.001,o=e.speedMax?e.speedMax-a:0,h=e.force||50,c=0,d=t.length;c<d;c++){var l=t[c];l.last={x:l.x,y:l.y},l.curr={x:l.x,y:l.y},s||(l.amp={x:Math.random()*n+r,y:Math.random()*n+r},l.angle={x:2*Math.random()*Math.PI,y:2*Math.random()*Math.PI},l.speed={x:Math.random()*o+a,y:Math.random()*o+a}),l.force=h,Object.assign(l,i)}},createEdges:function(){this.edges=[];var t,e,i=this.vertices.length;for(t=0;t<i;t++){var s=this.vertices[t];for(e=t+1;e<i;e++){var r=this.vertices[e];if(!s.border||!r.border){var n=s.static&&r.static,a=s.force+r.force;this.edges.push({v1:s,v2:r,lastA:0,currA:n?1-Math.min(Math.sqrt(Math.pow(r.curr.x-s.curr.x,2)+Math.pow(r.curr.y-s.curr.y,2))/a,1):0,force:a,static:n})}}}},setCursor:function(t,e,i){if(this.cursorPoint.curr={x:t,y:e},this.onlyInside&&i){var s=this.borderVertices[0];i.beginPath(),i.moveTo(s.x,s.y);for(var r=0,n=this.borderVertices.length;r<n;r++){var a=this.borderVertices[r];i.lineTo(a.x,a.y)}i.closePath(),this.cursorPoint.hidden=!i.isPointInPath(t,e)}},update:function(t){for(var e=0,i=this.vertices.length;e<i;e++){var s=this.vertices[e];s.static||(s.last={x:s.curr.x,y:s.curr.y},s.angle.x+=t*s.speed.x,s.angle.y+=t*s.speed.y,s.curr={x:s.x+s.amp.x*Math.sin(s.angle.x),y:s.y+s.amp.y*Math.cos(s.angle.y)})}for(e=0,i=this.edges.length;e<i;e++){var r=this.edges[e];if(!r.static){var n=r.v1,a=r.v2;r.lastA=r.currA,r.currA=1-Math.min(Math.sqrt(Math.pow(a.curr.x-n.curr.x,2)+Math.pow(a.curr.y-n.curr.y,2))/r.force,1)}}},render:function(t,e){e.lineCap="round",e.lineWidth=1,e.strokeStyle=this.borderStrokeStyle;var i=this.borderVertices[0];e.beginPath(),e.moveTo(i.x,i.y);for(var s=0,r=this.borderVertices.length;s<r;s++){var n=this.borderVertices[s];e.lineTo(n.x,n.y)}e.closePath(),e.stroke();for(s=0,r=this.edges.length;s<r;s++){var a=this.edges[s];if(!(a.currA<=0)){var o,h,c,d,l=a.v1,f=a.v2;if(!l.hidden&&!f.hidden)a.static?e.strokeStyle="rgba(255,255,255,"+a.currA+")":e.strokeStyle="rgba(255,255,255,"+(a.lastA+(a.currA-a.lastA)*t)+")",l.static?(o=l.curr.x,h=l.curr.y):(o=l.last.x+(l.curr.x-l.last.x)*t,h=l.last.y+(l.curr.y-l.last.y)*t),f.static?(c=f.curr.x,d=f.curr.y):(c=f.last.x+(f.curr.x-f.last.x)*t,d=f.last.y+(f.curr.y-f.last.y)*t),e.beginPath(),e.moveTo(o,h),e.lineTo(c,d),e.stroke()}}e.strokeStyle="rgb(255,255,255)",e.lineWidth=3;for(s=0,r=this.vertices.length;s<r;s++){var p,u;(n=this.vertices[s]).hidden||(n.static?(p=n.curr.x,u=n.curr.y):(p=n.last.x+(n.curr.x-n.last.x)*t,u=n.last.y+(n.curr.y-n.last.y)*t),e.beginPath(),e.moveTo(p,u),e.lineTo(p+.2,u+.2),e.stroke())}}});
/*! Orion - core */
var Orion=function(t){this.init(t)};Object.assign(Orion.prototype,{init:function(t){this.viewport=t.viewport,this.canvas=this.createCanvas(),this.ctx=this.canvas.getContext("2d"),this.eventHandler=t.eventHandler||t.viewport,this.fpsMeter=t.fpsMeter,this.w=t.w||1280,this.h=t.h||720,this.canvas.width=this.w,this.canvas.height=this.h,t.constellation.onlyInside&&(this.offScreenCanvas=this.createOffscreenCanvas(),this.offscreenCtx=this.offScreenCanvas.getContext("2d")),this.refresh(),this.loop=new Loop({fpsLimit:t.fpsLimit||36,handleUpdate:this.update.bind(this),handleRender:this.render.bind(this),fpsMeter:!!this.fpsMeter}),this.constellation=new OrionConstellation(t.constellation),this.bindEvents(),this.loop.start()},createCanvas:function(){var t=document.createElement("canvas");return Object.assign(t.style,{position:"relative",width:"100%",height:"auto"}),this.viewport.appendChild(t),t},createOffscreenCanvas:function(){return document.createElement("canvas")},refresh:function(){this.offset=this.viewport.getBoundingClientRect(),this.scale=Math.round(this.canvas.offsetWidth/this.canvas.width*1e5)/1e5},bindEvents:function(){this.eventHandler.addEventListener("mousemove",this.onMouseMove.bind(this)),window.addEventListener("resize",this.onWinResize.bind(this))},onMouseMove:function(t){var e=(t.pageX-this.offset.x)/this.scale,i=(t.pageY-this.offset.y)/this.scale;this.constellation.setCursor(e,i,this.offscreenCtx)},onWinResize:function(t){clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(this.onResizeTimeout.bind(this),200)},onResizeTimeout:function(){this.refresh()},update:function(t){this.constellation.update(t)},render:function(t,e){this.ctx.clearRect(0,0,this.w,this.h),this.constellation.render(t,this.ctx),this.fpsMeter&&(this.fpsMeter.innerText=Math.round(e)+" FPS")}});