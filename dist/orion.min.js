/*!
 * Orion
 * version: 2018.05.18
 * author: dobrapyra
 * url: https://github.com/dobrapyra/Orion
 */
/*! Polyfills - https://github.com/dobrapyra/EasyPure */
Object.keys||(Object.keys=function(t){if(t!==Object(t))throw new TypeError("Object.keys called on a non-object");var e,i=[];for(e in t)t.hasOwnProperty(e)&&i.push(e);return i}),Object.assign||(Object.assign=function(t){if(t!==Object(t))throw new TypeError("Object.assign called on a non-object");var e,i,s,r,n,o,a,h;for(e=Object(t),n=arguments.length,r=1;r<n;r++)if(i=arguments[r])for(a=(s=Object.keys(i)).length,o=0;o<a;o++)e[h=s[o]]=i[h];return e});
/*! GameLoop - https://github.com/dobrapyra/GameLoop */
var Loop=function(t){this.init(t)};Object.assign(Loop.prototype,{init:function(t){var e=function(){};this.onUpdate=t.handleUpdate||e,this.onRender=t.handleRender||e,this.onPanic=t.handlePanic||e,this.onRawFrame=t.handleRawFrame||null,this.timestep=t.timestep||1e3/60,this.minFrameTime=1e3/(t.fpsLimit||66),this.fpsMeter=t.fpsMeter||!0,this.started=!1,this.running=!1,this.rafId=null,this.lastFrameTime=0,this.lastFpsUpdate=0,this.framesThisSecond=0,this.delta=0,this.fps=this.fpsMeter?0:null,this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.initLoop=this.initLoop.bind(this),this.loop=this.loop.bind(this)},update:function(t){this.onUpdate(t)},render:function(t){this.onRender(t,this.fps)},start:function(){this.started||(this.started=!0,this.rafId=requestAnimationFrame(this.initLoop))},stop:function(){this.running=!1,this.started=!1,cancelAnimationFrame(this.rafId)},initLoop:function(t){this.render(1),this.running=!0,this.lastFrameTime=t,this.lastFpsUpdate=t,this.framesThisSecond=0,this.rafId=requestAnimationFrame(this.loop)},loop:function(t){if(null!==this.onRawFrame)return this.onRawFrame(t),void(this.rafId=requestAnimationFrame(this.loop));if(t<this.lastFrameTime+this.minFrameTime)this.rafId=requestAnimationFrame(this.loop);else{this.delta+=t-this.lastFrameTime,this.lastFrameTime=t,this.fpsMeter&&(t>this.lastFpsUpdate+1e3&&(this.fps=this.framesThisSecond,this.lastFpsUpdate=t,this.framesThisSecond=0),this.framesThisSecond++);for(var e=0;this.delta>=this.timestep;)if(this.update(this.timestep),this.delta-=this.timestep,240<=++e){this.panic();break}this.render(this.delta/this.timestep),this.rafId=requestAnimationFrame(this.loop)}},panic:function(){this.delta=0,this.onPanic()}});
/*! Orion - constellation */
var OrionConstellation=function(t){this.init(t)};Object.assign(OrionConstellation.prototype,{init:function(t){var e=t.constellation||{},i=e.points||{},s=e.force||{},r=e.amplitude||{},n=e.speed||{},o=e.opacity||{},a=e.lineWidth||{},h=e.dotSize||{},c=this.density=t.density||1;this.onlyInside=e.onlyInside||!1,this.quickDetect=e.quickDetect||.02,this.outsideDetect=Object.assign({border:0,inside:1,cursor:3},e.outsideDetect),this.borderVertices=Object.assign([],this.recalcPoints(i.border)),this.prepareVertices(this.borderVertices,{force:(s.border||60)*c,dotSize:(h.border||3)/2*c},{static:!0,border:!0}),this.insideVertices=Object.assign([],this.recalcPoints(i.inside)),this.prepareVertices(this.insideVertices,{ampMin:r.min*c,ampMax:r.max*c,speedMin:n.min,speedMax:n.max,force:(s.inside||40)*c,dotSize:(h.inside||3)/2*c}),this.cursorPoint={curr:{x:0,y:0},cursor:!0,hidden:!!this.onlyInside,force:(s.cursor||120)*c,dotSize:(h.cursor||3)/2*c},this.vertices=[].concat(this.borderVertices,this.insideVertices),this.vertices.push(this.cursorPoint),this.createEdges(),this.cursorPoint.static=!0,this.lineWidth={border:(a.border||1)*c,inside:(a.inside||1)*c},this.borderStrokeStyle="rgba(255,255,255,"+(void 0!==o.border?o.border:.5)+")"},recalcPoints:function(t){var e=this.density;return 1!==e?t.map(function(t){return{x:t.x*e,y:t.y*e}}):t},prepareVertices:function(t,e,i){for(var s=!(!i||!i.static),r=void 0!==e.ampMin?e.ampMin:10,n=e.ampMax?e.ampMax-r:0,o=e.speedMin||.001,a=e.speedMax?e.speedMax-o:0,h=e.force||50,c=e.dotSize||3,d=0,l=t.length;d<l;d++){var u=t[d];u.last={x:u.x,y:u.y},u.curr={x:u.x,y:u.y},s||(u.amp={x:Math.random()*n+r,y:Math.random()*n+r},u.angle={x:2*Math.random()*Math.PI,y:2*Math.random()*Math.PI},u.speed={x:Math.random()*a+o,y:Math.random()*a+o}),u.force=h,u.dotSize=c,Object.assign(u,i)}},createEdges:function(){this.edges=[];var t,e,i=this.vertices.length;for(t=0;t<i;t++){var s=this.vertices[t];for(e=t+1;e<i;e++){var r=this.vertices[e];if(!s.border||!r.border){var n=!(!s.static||!r.static),o=s.force+r.force,a={v1:s,v2:r,lastA:0,currA:n?1-Math.min(Math.sqrt(Math.pow(r.curr.x-s.curr.x,2)+Math.pow(r.curr.y-s.curr.y,2))/o,1):0,force:o,static:n},h="inside";(s.border||r.border)&&(a.quickDetect=!0,h="border"),(s.cursor||r.cursor)&&(h="cursor"),a.outsideDetect=(this.outsideDetect[h]||0)+1,this.edges.push(a)}}}},setOutsideDetector:function(t){var e=this.borderVertices[0];t.beginPath(),t.moveTo(e.x,e.y);for(var i=0,s=this.borderVertices.length;i<s;i++){var r=this.borderVertices[i];t.lineTo(r.x,r.y)}t.closePath()},setCursor:function(t,e,i){this.cursorPoint.curr={x:t,y:e},this.onlyInside&&(this.cursorPoint.hidden=!i.isPointInPath(t,e))},edgeOutsideDetect:function(t,e){var i=t.outsideDetect;if(1!==i)for(var s=t.v1.curr,r=t.v2.curr,n=(r.x-s.x)/i,o=(r.y-s.y)/i,a=1;a<i&&!(t.hidden=!e.isPointInPath(s.x+a*n,s.y+a*o));a++);},edgeQuickDetect:function(t,e){var i=t.v1.curr,s=t.v2.curr,r=(s.x-i.x)*this.quickDetect,n=(s.y-i.y)*this.quickDetect;t.v1.border?t.hidden=!e.isPointInPath(i.x+r,i.y+n):t.hidden=!e.isPointInPath(s.x-r,s.y-n)},update:function(t,e){for(var i=0,s=this.vertices.length;i<s;i++){var r=this.vertices[i];r.static||(r.last={x:r.curr.x,y:r.curr.y},r.angle.x+=t*r.speed.x,r.angle.y+=t*r.speed.y,r.curr={x:r.x+r.amp.x*Math.sin(r.angle.x),y:r.y+r.amp.y*Math.cos(r.angle.y)})}for(i=0,s=this.edges.length;i<s;i++){var n=this.edges[i];if(!n.static){if(this.onlyInside){if(n.quickDetect&&(this.edgeQuickDetect(n,e),n.hidden))continue;if(this.edgeOutsideDetect(n,e),n.hidden)continue}if(n.hidden=!(!n.v1.hidden&&!n.v2.hidden),!n.hidden){var o=n.v1.curr,a=n.v2.curr;n.lastA=n.currA,n.currA=1-Math.min(Math.sqrt(Math.pow(a.x-o.x,2)+Math.pow(a.y-o.y,2))/n.force,1)}}}},render:function(t,e){e.lineCap="round",e.lineWidth=this.lineWidth.border,e.strokeStyle=this.borderStrokeStyle;var i=this.borderVertices[0];e.beginPath(),e.moveTo(i.x,i.y);for(var s=0,r=this.borderVertices.length;s<r;s++){var n=this.borderVertices[s];e.lineTo(n.x,n.y)}e.closePath(),e.stroke(),this.lineWidth.inside!==this.lineWidth.border&&(e.lineWidth=this.lineWidth.inside);for(s=0,r=this.edges.length;s<r;s++){var o=this.edges[s];if(!(o.hidden||o.currA<=0)){var a,h,c,d,l=o.v1,u=o.v2;if(!l.hidden&&!u.hidden)o.static?e.strokeStyle="rgba(255,255,255,"+o.currA+")":e.strokeStyle="rgba(255,255,255,"+(o.lastA+(o.currA-o.lastA)*t)+")",l.static?(a=l.curr.x,h=l.curr.y):(a=l.last.x+(l.curr.x-l.last.x)*t,h=l.last.y+(l.curr.y-l.last.y)*t),u.static?(c=u.curr.x,d=u.curr.y):(c=u.last.x+(u.curr.x-u.last.x)*t,d=u.last.y+(u.curr.y-u.last.y)*t),e.beginPath(),e.moveTo(a,h),e.lineTo(c,d),e.stroke()}}e.fillStyle="rgb(255,255,255)";var f=2*Math.PI;for(s=0,r=this.vertices.length;s<r;s++){var p,v;(n=this.vertices[s]).hidden||(n.static?(p=n.curr.x,v=n.curr.y):(p=n.last.x+(n.curr.x-n.last.x)*t,v=n.last.y+(n.curr.y-n.last.y)*t),e.beginPath(),e.arc(p,v,n.dotSize,0,f),e.fill())}}});
/*! Orion - core */
var Orion=function(t){this.init(t)};Object.assign(Orion.prototype,{init:function(t){this.viewport=t.viewport,this.canvas=this.createCanvas(),this.ctx=this.canvas.getContext("2d"),this.eventHandler=t.eventHandler||t.viewport,this.fpsMeter=t.fpsMeter||null;var e=t.density||1;this.w=(t.w||1280)*e,this.h=(t.h||720)*e,this.canvas.width=this.w,this.canvas.height=this.h,this.refresh(),this.loop=new Loop({fpsLimit:t.fpsLimit||36,handleUpdate:this.update.bind(this),handleRender:this.render.bind(this),fpsMeter:!!this.fpsMeter}),this.constellation=new OrionConstellation({constellation:t.constellation,density:e}),t.constellation.onlyInside&&(this.offScreenCanvas=this.createOffscreenCanvas(),this.offscreenCtx=this.offScreenCanvas.getContext("2d"),this.constellation.setOutsideDetector(this.offscreenCtx)),this.bindEvents(),this.loop.start()},createCanvas:function(){var t=document.createElement("canvas");return Object.assign(t.style,{position:"relative",width:"100%",height:"auto"}),this.viewport.appendChild(t),t},createOffscreenCanvas:function(){return document.createElement("canvas")},refresh:function(){this.offset=this.viewport.getBoundingClientRect(),this.scroll={top:window.scrollY||window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop||0,left:window.scrollX||window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft||0};var t=this.offset.width/this.viewport.offsetWidth;this.scale=Math.round(this.canvas.offsetWidth/this.canvas.width*t*1e5)/1e5},bindEvents:function(){this.eventHandler.addEventListener("mousemove",this.onMouseMove.bind(this)),window.addEventListener("resize",this.callRefresh.bind(this)),document.addEventListener("scroll",this.callRefresh.bind(this))},onMouseMove:function(t){var e=(t.pageX-this.offset.left-this.scroll.left)/this.scale,i=(t.pageY-this.offset.top-this.scroll.top)/this.scale;this.constellation.setCursor(e,i,this.offscreenCtx)},callRefresh:function(t){clearTimeout(this.refresfTimeout),this.refresfTimeout=setTimeout(this.onRefreshTimeout.bind(this),100)},onRefreshTimeout:function(){this.refresh()},update:function(t){this.constellation.update(t,this.offscreenCtx)},render:function(t,e){this.ctx.clearRect(0,0,this.w,this.h),this.constellation.render(t,this.ctx),this.fpsMeter&&(this.fpsMeter.innerText=Math.round(e)+" FPS")}});