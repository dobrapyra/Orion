/*!
 * Orion
 * version: 2018.05.12
 * author: dobrapyra
 * url: https://github.com/dobrapyra/Orion
 */
Object.keys||(Object.keys=function(t){if(t!==Object(t))throw new TypeError("Object.keys called on a non-object");var e,s=[];for(e in t)t.hasOwnProperty(e)&&s.push(e);return s}),Object.assign||(Object.assign=function(t){if(t!==Object(t))throw new TypeError("Object.assign called on a non-object");var e,s,i,r,n,o,a,h;for(e=Object(t),n=arguments.length,r=1;r<n;r++)if(s=arguments[r])for(a=(i=Object.keys(s)).length,o=0;o<a;o++)e[h=i[o]]=s[h];return e}),Element.prototype.getOffset=function(t,e){var s,i={l:0,t:0};for(s=this;s&&s!==t;s=s.offsetParent)i.l+=s.offsetLeft,i.t+=s.offsetTop,e&&(i.l-=s.scrollLeft,i.t-=s.scrollTop);return i};
/*! url: https://github.com/dobrapyra/GameLoop */
var Loop=function(t){this.init(t)};Object.assign(Loop.prototype,{init:function(t){var e=function(){};this.onUpdate=t.handleUpdate||e,this.onRender=t.handleRender||e,this.onPanic=t.handlePanic||e,this.onRawFrame=t.handleRawFrame||null,this.timestep=t.timestep||1e3/60,this.minFrameTime=1e3/(t.fpsLimit||66),this.fpsMeter=t.fpsMeter||!0,this.started=!1,this.running=!1,this.rafId=null,this.lastFrameTime=0,this.lastFpsUpdate=0,this.framesThisSecond=0,this.delta=0,this.fps=this.fpsMeter?0:null,this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.initLoop=this.initLoop.bind(this),this.loop=this.loop.bind(this)},update:function(t){this.onUpdate(t)},render:function(t){this.onRender(t,this.fps)},start:function(){this.started||(this.started=!0,this.rafId=requestAnimationFrame(this.initLoop))},stop:function(){this.running=!1,this.started=!1,cancelAnimationFrame(this.rafId)},initLoop:function(t){this.render(1),this.running=!0,this.lastFrameTime=t,this.lastFpsUpdate=t,this.framesThisSecond=0,this.rafId=requestAnimationFrame(this.loop)},loop:function(t){if(null!==this.onRawFrame)return this.onRawFrame(t),void(this.rafId=requestAnimationFrame(this.loop));if(t<this.lastFrameTime+this.minFrameTime)this.rafId=requestAnimationFrame(this.loop);else{this.delta+=t-this.lastFrameTime,this.lastFrameTime=t,this.fpsMeter&&(t>this.lastFpsUpdate+1e3&&(this.fps=this.framesThisSecond,this.lastFpsUpdate=t,this.framesThisSecond=0),this.framesThisSecond++);for(var e=0;this.delta>=this.timestep;)if(this.update(this.timestep),this.delta-=this.timestep,240<=++e){this.panic();break}this.render(this.delta/this.timestep),this.rafId=requestAnimationFrame(this.loop)}},panic:function(){this.delta=0,this.onPanic()}});var OrionConstellation=function(t){this.init(t)};Object.assign(OrionConstellation.prototype,{init:function(t){var e=t.points||{},s=t.force||{},i=t.amplitude||{},r=t.speed||{},n=t.opacity||{};this.onlyInside=t.onlyInside||!1,this.borderVertices=Object.assign([],e.border),this.prepareVertices(this.borderVertices,{force:s.border||60},{static:!0,border:!0}),this.insideVertices=Object.assign([],e.inside),this.prepareVertices(this.insideVertices,{ampMin:i.min,ampMax:i.max,speedMin:r.min,speedMax:r.max,force:s.border||40}),this.cursorPoint={curr:{x:0,y:0},hidden:!!this.onlyInside,force:s.cursor||120},this.vertices=[].concat(this.borderVertices,this.insideVertices),this.vertices.push(this.cursorPoint),this.createEdges(),this.cursorPoint.static=!0,this.borderStrokeStyle="rgba(255,255,255,"+(void 0!==n.border?n.border:.5)+")"},prepareVertices:function(t,e,s){for(var i=!(!s||!s.static),r=void 0!==e.ampMin?e.ampMin:10,n=e.ampMax?e.ampMax-r:0,o=e.speedMin||.001,a=e.speedMax?e.speedMax-o:0,h=e.force||50,c=0,d=t.length;c<d;c++){var f=t[c];f.last={x:f.x,y:f.y},f.curr={x:f.x,y:f.y},i||(f.amp={x:Math.random()*n+r,y:Math.random()*n+r},f.angle={x:2*Math.random()*Math.PI,y:2*Math.random()*Math.PI},f.speed={x:Math.random()*a+o,y:Math.random()*a+o}),f.force=h,Object.assign(f,s)}},createEdges:function(){this.edges=[];var t,e,s=this.vertices.length;for(t=0;t<s;t++){var i=this.vertices[t];for(e=t+1;e<s;e++){var r=this.vertices[e];if(!i.border||!r.border){var n=i.static&&r.static,o=i.force+r.force;this.edges.push({v1:i,v2:r,lastA:0,currA:n?1-Math.min(Math.sqrt(Math.pow(r.curr.x-i.curr.x,2)+Math.pow(r.curr.y-i.curr.y,2))/o,1):0,force:o,static:n})}}}},setCursor:function(t,e,s){if(this.cursorPoint.curr={x:t,y:e},this.onlyInside&&s){var i=this.borderVertices[0];s.beginPath(),s.moveTo(i.x,i.y);for(var r=0,n=this.borderVertices.length;r<n;r++){var o=this.borderVertices[r];s.lineTo(o.x,o.y)}s.closePath(),this.cursorPoint.hidden=!s.isPointInPath(t,e)}},update:function(t){for(var e=0,s=this.vertices.length;e<s;e++){var i=this.vertices[e];i.static||(i.last={x:i.curr.x,y:i.curr.y},i.angle.x+=t*i.speed.x,i.angle.y+=t*i.speed.y,i.curr={x:i.x+i.amp.x*Math.sin(i.angle.x),y:i.y+i.amp.y*Math.cos(i.angle.y)})}for(e=0,s=this.edges.length;e<s;e++){var r=this.edges[e];if(!r.static){var n=r.v1,o=r.v2;r.lastA=r.currA,r.currA=1-Math.min(Math.sqrt(Math.pow(o.curr.x-n.curr.x,2)+Math.pow(o.curr.y-n.curr.y,2))/r.force,1)}}},render:function(t,e){e.lineCap="round",e.lineWidth=1,e.strokeStyle=this.borderStrokeStyle;var s=this.borderVertices[0];e.beginPath(),e.moveTo(s.x,s.y);for(var i=0,r=this.borderVertices.length;i<r;i++){var n=this.borderVertices[i];e.lineTo(n.x,n.y)}e.closePath(),e.stroke();for(i=0,r=this.edges.length;i<r;i++){var o=this.edges[i];if(!(o.currA<=0)){var a,h,c,d,f=o.v1,l=o.v2;if(!f.hidden&&!l.hidden)o.static?e.strokeStyle="rgba(255,255,255,"+o.currA+")":e.strokeStyle="rgba(255,255,255,"+(o.lastA+(o.currA-o.lastA)*t)+")",f.static?(a=f.curr.x,h=f.curr.y):(a=f.last.x+(f.curr.x-f.last.x)*t,h=f.last.y+(f.curr.y-f.last.y)*t),l.static?(c=l.curr.x,d=l.curr.y):(c=l.last.x+(l.curr.x-l.last.x)*t,d=l.last.y+(l.curr.y-l.last.y)*t),e.beginPath(),e.moveTo(a,h),e.lineTo(c,d),e.stroke()}}e.strokeStyle="rgb(255,255,255)",e.lineWidth=3;for(i=0,r=this.vertices.length;i<r;i++){var u,p;(n=this.vertices[i]).hidden||(n.static?(u=n.curr.x,p=n.curr.y):(u=n.last.x+(n.curr.x-n.last.x)*t,p=n.last.y+(n.curr.y-n.last.y)*t),e.beginPath(),e.moveTo(u,p),e.lineTo(u+.2,p+.2),e.stroke())}}});var Orion=function(t){this.init(t)};Object.assign(Orion.prototype,{init:function(t){this.viewport=t.viewport,this.canvas=this.createCanvas(),this.ctx=this.canvas.getContext("2d"),this.eventHandler=t.eventHandler||t.viewport,this.fpsMeter=t.fpsMeter,this.w=t.w||1280,this.h=t.h||720,this.canvas.width=this.w,this.canvas.height=this.h,t.constellation.onlyInside&&(this.offScreenCanvas=this.createOffscreenCanvas(),this.offscreenCtx=this.offScreenCanvas.getContext("2d")),this.customCursorOffset=t.customCursorOffset||{x:0,y:0},this.refreshContext(),this.loop=new Loop({fpsLimit:t.fpsLimit||36,handleUpdate:this.update.bind(this),handleRender:this.render.bind(this),fpsMeter:!!this.fpsMeter}),this.constellation=new OrionConstellation(t.constellation),this.bindEvents(),this.loop.start()},createCanvas:function(){var t=document.createElement("canvas");return Object.assign(t.style,{position:"relative",width:"100%",height:"auto"}),this.viewport.appendChild(t),t},createOffscreenCanvas:function(){return document.createElement("canvas")},refreshContext:function(){this.scale=Math.round(this.canvas.offsetWidth/this.canvas.width*1e5)/1e5,this.viewportOffset=this.viewport.getOffset()},bindEvents:function(){this.eventHandler.addEventListener("mousemove",this.onMouseMove.bind(this)),window.addEventListener("resize",this.onWinResize.bind(this))},onMouseMove:function(t){var e=(t.pageX-this.viewportOffset.l+this.customCursorOffset.x)/this.scale,s=(t.pageY-this.viewportOffset.t+this.customCursorOffset.y)/this.scale;this.constellation.setCursor(e,s,this.offscreenCtx)},onWinResize:function(t){clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(this.onResizeTimeout.bind(this),200)},onResizeTimeout:function(){this.refreshContext()},setCustomCursorOffset:function(t){this.customCursorOffset={x:t.x,y:t.y}},update:function(t){this.constellation.update(t)},render:function(t,e){this.ctx.clearRect(0,0,this.w,this.h),this.constellation.render(t,this.ctx),this.fpsMeter&&(this.fpsMeter.innerText=Math.round(e)+" FPS")}});